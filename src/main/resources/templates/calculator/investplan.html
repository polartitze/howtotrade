<!DOCTYPE html>
<html lang="en">
<link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="/css/style.css">
<head>
    
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Investasi</title>
    
    <link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
	<link href="assets/slider/css/bootstrap.min.css" rel="stylesheet">
	<link href="assets/slider/css/bootstrap-icons.css" rel="stylesheet">
	
	<link rel="stylesheet" th:href="@{/assets/css/dataTables.bootstrap4.min.css}">
	<link rel="stylesheet" th:href="@{/assets/css/buttons.dataTables.min.css}">
	<link rel="stylesheet" th:href="@{/assets/css/bootstrap.min.css}">
	<link rel="stylesheet" th:href="@{/assets/css/style.css}">
	
	<script th:src="@{/assets/js_table/jquery.min.js}"></script>
	<script th:src="@{/assets/js_table/bootstrap.min.js}"></script>
	<script th:src="@{/assets/js_table/jquery.dataTables.min.js}"></script>
	<script th:src="@{/assets/js_table/dataTables.bootstrap4.min.js}"></script>
	<script th:src="@{/assets/js_table/dataTables.buttons.min.js}"></script>
	<script th:src="@{/assets/js_table/buttons.print.min.js}"></script>
	
	<link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="https://pixinvent.com/stack-responsive-bootstrap-4-admin-template/app-assets/css/bootstrap-extended.min.css">
	<link rel="stylesheet" type="text/css" href="https://pixinvent.com/stack-responsive-bootstrap-4-admin-template/app-assets/fonts/simple-line-icons/style.min.css">
	<link rel="stylesheet" type="text/css" href="https://pixinvent.com/stack-responsive-bootstrap-4-admin-template/app-assets/css/colors.min.css">
	<link rel="stylesheet" type="text/css" href="https://pixinvent.com/stack-responsive-bootstrap-4-admin-template/app-assets/css/bootstrap.min.css">
	<link href="https://fonts.googleapis.com/css?family=Montserrat&display=swap" rel="stylesheet">

  <script th:src="@{/js/accounting.js}"></script>

</head>
<body style="background-color: #eee">
	<div class="row gutters">
    	<div class="">
      		<div class="">
        		<a th:href="@{'/'}" class="btn text-black" style="text-decoration:none">
        			<i class="fa fa-arrow-left"></i>
        		</a>
      		</div>
    	</div>
  	</div>
  <div class="investplan_banner"></div>
  <div class="container-fluid">
    <div class="">
    	
          
      <form th:action="@{/calculator/save-calculation}" th:object="${calculatorForm}" method="post" id="forms" onsubmit="test()">
        <section id="stats-subtitle">
          <div class="row">
            <div class="col-12 mt-3 mb-1 text-center text-black">
              <h2 class="text-uppercase">Kalkulator Investasi</h2>
              <p>Mulai Perhitungkan, Cicil Berinvestasi, dan Nikmati Hasilnya Kelak!</p>
            </div>
          </div>
          <div class="row">
            <div class="col-xl-6 mx-auto">
              <div class="card overflow-hidden">
                <div class="card-content">
                  <div class="card-body cleartfix">
                    <div class="media align-items-stretch">
                      <div class="align-self-center">
                        <i class="icon-calculator primary font-large-2 mr-2"></i>
                      </div>
                      <div class="media-body">
                        <h4>Output Perhitungan</h4>
                        <select class="form-select" style="height: calc(2.75rem + 2px)" id="jenisPerhitungan" th:field="${calculatorForm.calculatorType.calculatorTypeId}">
                          <option th:each="list : ${listCalcType}" th:value="${list.calculatorTypeId}" th:text="${list.calculatorTypeName}"></option>
                        </select>
                      </div>
                      <div class="align-self-center">
                        <h1></h1>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
          </div>
          <div class="row">
            <div class="col-md-12 col-12">
              <div class="alert alert-danger" id="calcuAlert" style="display: none;">
              </div>
            </div>
          </div>
        <div class="row">
          <div class="col-xl-6" id="investasiAwalBox">
            <div class="card">
              <div class="card-content">
                <div class="card-body cleartfix">
                  <div class="media align-items-stretch">
                    <div class="align-self-center">
                      <i class="icon-pin purple font-large-2 mr-2"></i>
                    </div>
                    <div class="media-body">
                      <h4>Investasi Awal</h4>
                      <div>
                        <input type="text" class="form-control numeric" th:field="${calculatorForm.investasiAwal}" id="investasiAwal" maxlength="15" required>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-xl-6" id="waktuBox">
            <div class="card">
              <div class="card-content">
                <div class="card-body cleartfix">
                  <div class="media align-items-stretch">
                    <div class="align-self-center">
                      <i class="icon-hourglass success font-large-2 mr-2"></i>
                    </div>
                    <div class="media-body">
                      <h4>Waktu Investasi (Tahun)</h4>
                      <div>
                        <input type="number" class="form-control" id="waktu" th:field="${calculatorForm.duration}" max="100" required>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

            <div class="col-xl-6" id="koinBox">
              <div class="card">
                <div class="card-content">
                  <div class="card-body cleartfix">
                    <div class="media align-items-stretch">
                      <div class="align-self-center">
                        <i class="icon-wallet danger font-large-2 mr-2"></i>
                      </div>
                      <div class="media-body">
                        <h4>Koin Pilihan</h4>
                        <select class="form-select" style="height: calc(2.75rem + 2px)" id="koin" th:field="${calculatorForm.coin.coinCode}" required>
                          <option value=""></option>
                          <option th:each="list : ${listCoin}" th:value="${list.coinCode}" th:text="${list.coinCode} + ' - ' + ${list.coinName}"></option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="col-xl-6" id="perBulanBox">
              <div class="card">
                <div class="card-content">
                  <div class="card-body cleartfix">
                    <div class="media align-items-stretch">
                      <div class="align-self-center">
                        <i class="icon-credit-card yellow font-large-2 mr-2"></i>
                      </div>
                      <div class="media-body">
                        <h4>Jumlah Investasi Per Bulan</h4>
                        <input type="text" class="form-control numeric" id="perBulan" th:field="${calculatorForm.investasiPerbulan}" maxlength="15">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
        </div>
          
          
          
        </section>
        
        <div class="row gutters">
          <div class="col-xl-12">
            <div class="text-center">
              <button type="button" class="btn btn-primary btn-calculate">Hitung</button>
            </div>
          </div>
        </div>

        <div class="row result my-2">
          <div class="col-xl-7 mx-auto">
            <div class="card overflow-hidden">
              <div class="card-content">
                <div class="card-body cleartfix">
                  <div class="media align-items-stretch">
                    <div class="align-self-center">
                      <i class="icon-calculator primary font-large-2 mr-2"></i>
                    </div>
                    <div class="media-body">
                      <h4>Hasil</h4>
                      <textarea rows="4" class="form-control" id="score" readonly="readonly" th:field="${calculatorForm.result}" style="white-space: pre-wrap;"></textarea>
                      <button type="submit" class="btn btn-primary btn-save float-right mt-2">Save Result</button>
                    </div>
                    <div class="align-self-center">
                      <h1></h1>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="card-body">
          <div class="row gutters">
            <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
              <div class="text-primary">
                <button type="button" class="btn btn-primary btn-history">Riwayat</button>
              </div>
            </div>
          </div>
          <br><br>
          
          
          <table id="table-history" class="table paging table-bordered table-hover bg-white mt-2 mydatatable">
            <caption>Perencanaan kamu sebelumnya</caption>
            <thead class="thead-dark">
              <tr>
                <th scope="col" class="text-center align-middle"> Tanggal Dibuat </th>
                <th scope="col" class="text-center align-middle"> Jenis Perhitungan </th>
                <th scope="col" class="text-center align-middle"> Investasi Awal </th>
                <th scope="col" class="text-center align-middle"> Investasi per Bulan </th>
                <th scope="col" class="text-center align-middle"> Waktu Investasi </th>
                <th scope="col" class="text-center align-middle"> Koin </th>
                <th scope="col" class="text-center align-middle"> Hasil </th>
                <th scope="col" class="text-center align-middle"> Action </th>
              </tr>
            </thead>
            <tbody>
              <tr th:if="${history.empty}">
                <td colspan="8" class="text-center"> Data tidak ditemukan </td>
              </tr>
              <tr th:each="list : ${history}">
                <td>
                  <span th:text="${list.created}"></span>
                </td>
                <td>
                  <span th:text="${list.calculatorType.calculatorTypeName}"></span>
                </td>
                <td class="text-center align-middle">
                  <span th:text="${list.investasiAwal}"></span>
                  </span>
                </td>
                <td class="text-center align-middle">
                  <span th:text="${list.investasiPerbulan}"></span>
                </td>
                <td class="text-center align-middle">
                  <span th:text="${list.duration}"></span>
                </td>
                <td class="text-center align-middle">
                  <span th:text="${list.coin.coinCode}"></span>
                </td>
                <td>
                  <span th:text="${list.result}"></span>
                </td>
                <td class="text-center align-middle">
                  <a href="#del-modal" th:data-id="${list.calculatorId}"
                  class="open-del-modal" data-toggle="modal"><i class="fa fa-trash text-danger"></i></a>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
    </div>
    </form>
  </div>
  <div th:replace="fragments/logout :: logout">&nbsp;</div>
  
  <div class="modal" id="del-modal">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0">
          <div class="modal-header border-0 pb-0">
            <h4>Delete Investment Planning</h4>
            <button type="button" class="close" data-dismiss="modal">X</button>
          </div>
          <div class="modal-body border-0 pb-0">
            <p>Are you sure to delete?</p>
          </div>
          <div class="modal-footer">
            <a class="btn btn-danger text-white modal-yes">Yes</a>
            <a class="btn btn-info text-white" data-dismiss="modal">No</a>
          </div>
        </div>
      </div>
    </div>
	    
  
  
  <script th:if="${#request.getParameter('error') == 'true'}">
      $(document).ready(function(){
          $('#loginModal').modal('show');
      });
  </script>
					<!-- JAVASCRIPT CODE -->
  <script type="text/javascript">
		$(document).ready(function () {
        var jenisPerhitungan;
        // var totalInvestasi;
        var koin;
        var waktu;
        var perBulan;
        var hasil;
        $('#jenisPerhitungan').val("1");
        $("#koin").removeAttr("disabled");
        $("#perBulan").removeAttr("disabled");
        $("#waktu").removeAttr("disabled");
        $("#investasiAwal").removeAttr("disabled")

        $('#waktu').val('');
        $('#table-history').hide();

 		    $('#table-history_wrapper').hide();
        $('.result').hide();
        initForm();
      
    });

      
      function test(){
        alert(calculateForm);
      }

      function initForm() {
        $(".numeric").on("keyup", function(event) {                   
            // When user select text in the document, also abort.
            var selection = window.getSelection().toString(); 
            if (selection !== '') {
                return; 
            }       
            // When the arrow keys are pressed, abort.
            if ($.inArray(event.keyCode, [38, 40, 37, 39]) !== -1) {
                return; 
            }       
            var $this = $(this);            
            // Get the value.
            var input = $this.val();            
            input = input.replace(/[\D\s\._\-]+/g, ""); 
            input = input?parseInt(input, 10):0; 
            $this.val(function () {
                return (input === 0)?"":input.toLocaleString("en-US"); 
            }); 
        });

        $('.btn-history').click(function(){
          $('#table-history').show();
          $('.mydatatable').show();
          $('#table-history_wrapper').show();
        });

        $('.btn-calculate').click(function(){
          jenisPerhitungan = $('#jenisPerhitungan').val();
            if(jenisPerhitungan == '1' ){
              if($('#koin').val() == '' ||
                $('#waktu').val() == '' ||
                $('#perBulan').val() == ''){
                  $("#calcuAlert").html("Field Harus Terisi !");
                  $("#calcuAlert").show();
                  return;
                }
            }
            else if(jenisPerhitungan == '2'){
              if($('#koin').val() == '' || $('#waktu').val() == '' ){
                $("#calcuAlert").html("Field Harus Terisi !");
                $("#calcuAlert").show();
                return;
              }
            }

            koin = $('#koin').val();
            waktu = $('#waktu').val();
            perBulan = $('#perBulan').val().replaceAll(',','');
            investasiAwal = $('#investasiAwal').val().replaceAll(',','');
            hasil = getResult(jenisPerhitungan,koin,waktu,perBulan, investasiAwal);
            if(hasil == null || '' == hasil) $('.result').hide();
            else {
              hasil = accounting.formatMoney(hasil, "Rp", 2, ".", ",");
                $('#score').val("Hasil investasi Anda dalam " + waktu + " tahun mendatang : " + hasil);
                $('.result').show();
            }
        });

        $("#jenisPerhitungan").on('change', function(){
          $("#calcuAlert").hide();
          var option = $("#jenisPerhitungan").val();
            if(option == '1'){
              $("#koinBox,#perBulanBox,#waktuBox,#investasiAwalBox").show();
              $("#koin").removeAttr("disabled");
              $("#perBulan").removeAttr("disabled");
              $("#waktu").removeAttr("disabled");
              $("#investasiAwal").removeAttr("disabled")
              $("#koin,#perBulan,#waktu,#investasiAwal").val('');
            }

            else if(option == '2'){
              $("#koinBox,#perBulanBox,#waktuBox,#investasiAwalBox").show();
              $("#perBulan").attr("disabled", "disabled");
              $("#perBulanBox").hide();
              $("#koin").removeAttr("disabled");
              $("#waktu").removeAttr("disabled")
              $("#investasiAwal").removeAttr("disabled")
              $("#koin,#perBulan,#waktu,#investasiAwal").val('');
            }
        });

          
		}

    function getResult(jenisPerhitungan,koin,waktu,perBulan, investasiAwal){
        var retval;
        console.log(jenisPerhitungan);
        $.ajax({
            method: 'GET',
            async: false,
            data: {
                'jenisPerhitungan' : jenisPerhitungan,
                'koin' : koin,
                'waktu' : waktu,
                'perBulan' : perBulan,
                'investasiAwal' : investasiAwal
            },
            url: getContextPath()+'/calculator/calculate-result',
            success: function(data){
                if(data != null || data != ''){
                    retval = data;
                } 
            }
        });
        console.log(retval);
        return retval;
    }
    
    function getContextPath() {
      var root = window.location.protocol + "//" + window.location.host;
      return root;
    }


	</script>
	
	<script>
		$('.mydatatable').DataTable({
			dom: 'lBfrtip',
			"order": [0,'desc'],
			"lengthMenu": [ [5, 10, 25, 50, -1], [5, 10, 25, 50, "All"] ]
		});
		
		$(document).on("click", ".open-del-modal", function () {
		     var planningId = $(this).data('id');
		     $("#del-modal .modal-yes").attr("href", "/calculator/delete/" + planningId)
		});
	</script>

  <!-- JAVASCRIPT INTEGRATED WITH THYMELEAF   -->
  <!-- <script th:inline="javascript"> 
    /*<![CDATA[*/
    
        var message = /*[[${message}]]*/ 'default';
        console.log(message);
    
    /*]]>*/
    </script> -->
</body>
</html>
<!DOCTYPE html>
<html xmlns:th="www.thymeleaf.org">

<head>
	<meta charset="ISO-8859-1">
	<link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
	<!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet"> -->
	<link rel="stylesheet" href="font-awesome-4.7.0/css/font-awesome.min.css">
	<script th:src="@{/assets/js/jquery.min.js}"></script>
    <script th:src="@{/assets/js/bootstrap.min.js}"></script>
	<title>Register</title>
</head>

<body>
	<section class="vh-100" style="background-color: #eee;">
		<div class="container h-100">
		  <div class="row d-flex justify-content-center align-items-center h-100">
			<div class="col-lg-12 col-xl-11">
			  <div class="card text-black" style="border-radius: 25px;">
				<div class="card-body p-md-5">
				  <div class="row justify-content-center">
					<div class="col-md-10 col-lg-6 col-xl-5 order-2 order-lg-1">
	  
					  <p class="text-center h1 fw-bold mb-5 mx-1 mx-md-4 mt-4">Sign up</p>
	  
					  <form class="mx-1 mx-md-4">
	  
						<div class="d-flex flex-row align-items-center mb-4">
						  <i class="fas fa-user fa-lg me-3 fa-fw"></i>
						  <div class="form-outline flex-fill mb-0">
							<input type="text" id="form3Example1c" class="form-control" />
							<label class="form-label" for="form3Example1c">Your Name</label>
						  </div>
						</div>
	  
						<div class="d-flex flex-row align-items-center mb-4">
						  <i class="fas fa-envelope fa-lg me-3 fa-fw"></i>
						  <div class="form-outline flex-fill mb-0">
							<input type="email" id="form3Example3c" class="form-control" />
							<label class="form-label" for="form3Example3c">Your Email</label>
						  </div>
						</div>
	  
						<div class="d-flex flex-row align-items-center mb-4">
						  <i class="fas fa-lock fa-lg me-3 fa-fw"></i>
						  <div class="form-outline flex-fill mb-0">
							<input type="password" id="form3Example4c" class="form-control" />
							<label class="form-label" for="form3Example4c">Password</label>
						  </div>
						</div>
	  
						<div class="d-flex flex-row align-items-center mb-4">
						  <i class="fas fa-key fa-lg me-3 fa-fw"></i>
						  <div class="form-outline flex-fill mb-0">
							<input type="password" id="form3Example4cd" class="form-control" />
							<label class="form-label" for="form3Example4cd">Repeat your password</label>
						  </div>
						</div>
	  
						<div class="form-check d-flex justify-content-center mb-5">
						  <input
							class="form-check-input me-2"
							type="checkbox"
							value=""
							id="form2Example3c"
						  />
						  <label class="form-check-label" for="form2Example3">
							I agree all statements in <a href="#!">Terms of service</a>
						  </label>
						</div>
	  
						<div class="d-flex justify-content-center mx-4 mb-3 mb-lg-4">
						  <button type="button" class="btn btn-primary btn-lg">Register</button>
						</div>
	  
					  </form>
	  
					</div>
					<div class="col-md-10 col-lg-6 col-xl-7 d-flex align-items-center order-1 order-lg-2">
	  
					  <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-registration/draw1.webp" class="img-fluid" alt="Sample image">
	  
					</div>
				  </div>
				</div>
			  </div>
			</div>
		  </div>
		</div>
	</section>

	<div class="container-fluid center">
		<div class="card">
			<div class="card-body">
				<form th:action="@{/user/add}" th:object="${appUser}" method="post">
					<div class="row form-group">
						<div class="col-md-3 col-12">
							<label for="username">Username <span class="text-red">*</span></label>	
						</div>
						<div class="col-md-9 col-12">
							<input type="text" onchange="checkUsername()" class="form-control" th:field="*{userName}" id="username" name="username" required="required">	
						</div>
					</div>

					<div class="row">
						<div class="col-md-3 col-12"></div>
						<div class="col-md-9 col-12">
							<div class="alert alert-danger" id="usernameAlert" style="display: none;"></div>
						</div>
					</div>

					<div class="row form-group">
						<div class="col-md-3 col-12">
							<label for="password">Password <span class="text-red">*</span></label>
						</div>
						<div class="col-md-9 col-12">
							<input type="password" onchange="checkPassword()" class="form-control" th:field="*{userPassword}" id="password" name="password" required="required">
						</div>
					</div>

					<div class="row">
						<div class="col-md-3 col-12"></div>
						<div class="col-md-9 col-12">
							<div class="alert alert-danger" id="passwordAlert" style="display: none;"></div>
						</div>
					</div>

					<div class="row form-group">
						<div class="col-md-3 col-12">
							<label for="confirmPassword">Confirm Password <span class="text-red">*</span></label>
						</div>
						<div class="col-md-9 col-12">
							<input type="password" onchange="checkPassword()" class="form-control" id="confirmPassword" name="confirmPassword" required="required">
						</div>
					</div>

					<div class="row">
						<div class="col-md-3 col-12"></div>
						<div class="col-md-9 col-12">
							<div class="alert alert-danger" id="confirmPasswordAlert" style="display: none;"></div>
						</div>
					</div>

					 <input type="hidden" th:value="1" th:name="userRole">
					<!-- <div class="row form-group">
						<div class="col-md-3 col-12">
							<label for="userRole">User Role <span class="text-red">*</span></label>
						</div>
						<div class="col-md-9 col-12">
							<select class="form-control" th:field="*{userRole}" id="userRole" name="userRole">
								<option value="1">User</option>
								<option value="2">Admin</option>
							</select>
						</div>
					</div> -->

					<div class="text-center">
						<input type="submit" class="btn btn-primary" onclick="checkData()" value="Submit">
					</div>
				</form>
			</div>
		</div>
	</div>

	<!-- MODAL SUCCESS -->
	<div class="modal" id="successModal">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content border-0">
				<div class="modal-header border-0 pb-0">
					<h4>Register</h4>
					<button type="button" class="close" data-dismiss="modal">×</button>
				</div>
				<div class="modal-body border-0 pb-0">
					<p>User has been created!</p>
				</div>
				<div class="modal-footer">
					<a th:href="@{/}" class="btn btn-success" data-dismiss="modal">Ok</a>
				</div>
			</div>
		</div>
	</div>
	
	<!-- MODAL FAILED -->
	<div class="modal" id="failModal">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content border-0">
				<div class="modal-header border-0 pb-0">
					<h4>Register</h4>
					<button type="button" class="close" data-dismiss="modal">×</button>
				</div>
				<div class="modal-body border-0 pb-0">
					<p>Register user failed!</p>
				</div>
				<div class="modal-footer">
					<a th:href="@{/user/add}" class="btn btn-danger" data-dismiss="modal">Ok</a>
				</div>
			</div>
		</div>
	</div>

	<!-- JAVASCRIPT CODE -->
	<script type="text/javascript">
		$(document).ready(function () {
			//$('.error1').show();
			console.log('apin botak')
			initForm();
		});

		function initForm() {
			let username;
			let email;
			let password;
			let passwordConfirmation;
			$('#username').on('input', function () {
				username = $('#username').val();
				if (username.length < 5) {
					$('.error1').html('Username harus 5 sampai 20 karakter');
					$('.error1').show();
				} else {
					$('.error1').hide();
				}
			});
			$('#email').on('input', function () {
				email = $('#email').val();
				if (validateEmail(email) == false) {
					$('.error2').html('Email harus mengikuti format RCC 822 ');
					$('.error2').show();
				} else {
					$('.error2').hide();
				}
			});
			$('#password').on('input', function () {
				password = $('#password').val();
				if (password.length < 8) {
					$('.error3').html('Password minimal harus 8 karakter');
					$('.error3').show();
				}else{
					$('.error3').hide();
				}
				if (validatePassword() == false) {
					$('.error3').html('Password harus memiliki minimal 1 huruf kecil, 1 huruf besar, dan 1 angka');
					$('.error3').show();
				} else {
					$('.error3').hide();
				}
			});

			$('#passwordConfirmation').on('input', function () {
				password = $('#password').val();
				passwordConfirmation = $('#passwordConfirmation').val();
				if (passwordConfirmation != password) {
					$('.error4').html('Password tidak sesuai');
					$('.error4').show();
				} else {
					$('.error4').hide();
				}
			});

			$('.btn-save').on('click', function () {
				if ($('.error1').length || $('.error2').length || $('.error3').length || $('.error4').length) {
					alert('there is an error');
					return false;
				}
			});
		}
		function validateEmail(email) {
			var re = /\S+@\S+\.\S+/;
			return re.test(email);
		}

		function validatePassword(pw) {
			return /[A-Z]/.test(pw) &&
				/[a-z]/.test(pw) &&
				/[0-9]/.test(pw);
		}
	</script>

<script>
	function checkUsername() {
		var username = $("#username").val();
		var result = false;
		if (username.length < 6 || username.length > 20){
			$("#usernameAlert").show();
			$("#usernameAlert").html("Username must be 6-20 characters!");
			return false;
		}
		else {
			$.ajax({
				type: "GET",
				url: "/user/check/" + username,
				async: false,
				success: function(response) {
					$("#usernameAlert").html("Username must be unique!");
					if (response.status == "Success") {
						$("#usernameAlert").show();
						result = false;
					}
					else {
						$("#usernameAlert").hide();
						result = true;
					}
				}
			});
			return result;
		}
	}

	function checkPassword() {
		var pass = $("#password").val();
		var confirmPass = $("#confirmPassword").val();
		
		if (pass.length < 6 || pass.length > 50){
			$("#passwordAlert").html("Password must be at 6-50 characters!");
			$("#passwordAlert").show();
			if (pass != confirmPass) {
				$("#confirmPasswordAlert").html("Invalid confirm password!");
				$("#confirmPasswordAlert").show();
				return false;
			}
			else {
				$("#confirmPasswordAlert").hide();
				return false;
			}
		}
		else {
			$("#passwordAlert").hide();
			if (pass != confirmPass) {
				$("#confirmPasswordAlert").html("Invalid confirm password!");
				$("#confirmPasswordAlert").show();
				return false;
			}
			else {
				$("#confirmPasswordAlert").hide();
				return true;
			}
		}
	}

	function checkData() {
		if (checkUsername() && checkPassword()) {
			return true;
		}
		return false;
	}
</script>

<script>
	var url = window.location.href;
	if(url.indexOf('?success=true') != -1) {
		$('#successModal').modal('show');
	}
	if(url.indexOf('?success=false') != -1) {
		$('#failModal').modal('show');
	}
</script>
</body>

</html>